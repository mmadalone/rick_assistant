#!/usr/bin/env zsh
# _rick_menu_detect_terminal - Detect terminal capabilities for the menu system
#
# Usage:
#   _rick_menu_detect_terminal
#
# Returns:
#   Sets global variables for terminal support and dimensions
#
# Example:
#   _rick_menu_detect_terminal

# Function implementation
_rick_menu_detect_terminal() {
  # Determine color support
  if [[ "$COLORTERM" == "truecolor" || "$COLORTERM" == "24bit" ]] || \
     [[ "${terminfo[colors]:-0}" -ge 8 ]] || \
     [[ -n "$COLORTERM" && -n "$TERM" && "$TERM" != "dumb" ]] || \
     [[ -n "$RICK_FORCE_COLORS" ]]; then
    _RICK_MENU_SUPPORTS_COLOR=1
  else
    _RICK_MENU_SUPPORTS_COLOR=0
  fi
  
  # Determine Unicode support
  if [[ "$(locale charmap 2>/dev/null)" == *"UTF-8"* || \
        "$(locale -a 2>/dev/null)" == *"UTF-8"* || \
        "$LANG" == *"UTF-8"* || \
        "$LC_ALL" == *"UTF-8"* || \
        "$LC_CTYPE" == *"UTF-8"* || \
        -n "$RICK_FORCE_UNICODE" ]]; then
    _RICK_MENU_SUPPORTS_UNICODE=1
  else
    _RICK_MENU_SUPPORTS_UNICODE=0
  fi
  
  # Get terminal dimensions
  local dimensions=$(stty size 2>/dev/null || echo "24 80")
  _RICK_MENU_HEIGHT=${dimensions%% *}
  _RICK_MENU_WIDTH=${dimensions##* }
  
  # Set default menu dimensions
  RICK_MENU_HEIGHT=$(( _RICK_MENU_HEIGHT > 10 ? 10 : _RICK_MENU_HEIGHT - 2 ))
  RICK_MENU_WIDTH=$(( _RICK_MENU_WIDTH > 60 ? 60 : _RICK_MENU_WIDTH - 2 ))
  
  # Log the detected capabilities if debug is enabled
  if (( RICK_DEBUG )); then
    print "Terminal detection: color=${_RICK_MENU_SUPPORTS_COLOR}, unicode=${_RICK_MENU_SUPPORTS_UNICODE}, dimensions=${_RICK_MENU_WIDTH}x${_RICK_MENU_HEIGHT}"
  fi
}

# Call the function with the arguments passed to this script
_rick_menu_detect_terminal "$@" 